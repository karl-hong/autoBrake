C51 COMPILER V9.55   MAIN                                                                  01/15/2024 23:39:47 PAGE 1   


C51 COMPILER V9.55, COMPILATION OF MODULE MAIN
OBJECT MODULE PLACED IN .\Objects\main.obj
COMPILER INVOKED BY: D:\Program Files (x86)\Keil_C51\C51\BIN\C51.EXE ..\user\main.c OPTIMIZE(8,SPEED) BROWSE INCDIR(..\h
                    -al;..\user) DEBUG OBJECTEXTEND PRINT(.\Listings\main.lst) TABS(2) OBJECT(.\Objects\main.obj)

line level    source

   1          #define ALLOCATE_EXTERN
   2          #include "HC89S003AF4.h"
   3          #include "clock.h"
   4          #include "my_printf.h"
   5          #include <stdio.h>
   6          #include "typedef.h"
   7          #include "gpio.h"
   8          #include "led.h"
   9          #include "ie.h"
  10          #include "common.h"
  11          #include "key.h"
  12          #include "bat.h"
  13          #include "sc7a20.h"
  14          
  15          
  16          main_context_t gMainContext;
  17          
  18          void Delay_ms(unsigned int fui_i);
  19          void timer0_init(void);
  20          
  21          void main(void)
  22          {
  23   1        WDTCCR = 0x00;            //关闭看门狗
  24   1        /* init clock */
  25   1        clock_enable(CLK_EN_INTERNAL);
  26   1        clock_set_source(CLKSEL_INTERNEL_HIGH_RC);
  27   1        clock_set_rc32m_div(RC32M_CLK_2);//Fosc = 16M
  28   1        clock_set_cpu_div(1);//Fcpu = Fosc，由于串口需要Fosc = Fcpu
  29   1      
  30   1        /* init uart1 */
  31   1        UART1_Init();
  32   1        /* led init */
  33   1        led_init();
  34   1        /* timer init */
  35   1        timer0_init();
  36   1        /* key init */
  37   1        key_init();
  38   1        /* check bat init */
  39   1        bat_init();
  40   1        /* sc7a20 init */
  41   1        sc7a20_gpio_init();
  42   1        sc7a20_init();
  43   1      
  44   1        /* enable interrupt */
  45   1        user_set_interrupt_state(IE_TYPE_GLOBAL, IE_ENABLE);
  46   1           
  47   1        while(1){
  48   2          key_task();
  49   2          check_bat_task();
  50   2          bat_led_task();
  51   2          sc7a20_task();
  52   2        }
  53   1      }
  54          
C51 COMPILER V9.55   MAIN                                                                  01/15/2024 23:39:47 PAGE 2   

  55          
  56          void Delay_ms(unsigned int fui_i)
  57          {
  58   1        unsigned int fui_j;
  59   1        for(;fui_i > 0;fui_i --)
  60   1        for(fui_j = 1596;fui_j > 0;fui_j --);
  61   1      }
  62          
  63          void timer0_init(void)
  64          {
  65   1        TCON1 = 0x00;             //Tx0定时器时钟为Fosc
  66   1        TMOD = 0x00;              //16位重装载定时器/计数器
  67   1      
  68   1        //Tim0计算时间  = (65536 - 0xFACB) * (1 / (Fosc /Timer分频系数))
  69   1        //        = 1333 / (16000000 / 12)
  70   1        //        = 1 ms
  71   1      
  72   1        //定时1ms
  73   1        //反推初值  = 65536 - ((1/1000) / (1/(Fosc / Timer分频系数)))
  74   1        //        = 65536 - ((1/1000) / (1/(16000000 / 12)))
  75   1        //      = 65536 - 1333
  76   1        //      = 0xFACB
  77   1        TH0 = 0xFA;
  78   1        TL0 = 0xCB;               //T0定时时间1ms
  79   1        IE |= 0x02;               //打开T0中断
  80   1        TCON |= 0x10;             //使能T0
  81   1      }
  82          
  83          /***************************************************************************************
  84            * @说明   T0中断服务函数
  85            * @参数   无
  86            * @返回值 无
  87            * @注      无
  88          ***************************************************************************************/
  89          void TIMER0_Rpt(void) interrupt TIMER0_VECTOR
  90          { /* 1ms */
  91   1         gMainContext.mKeyDelay = true;
  92   1         gMainContext.mBatDelay = true;
  93   1         gMainContext.mLedDelay = true;
  94   1         gMainContext.mSc7a20Delay = true;
  95   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    130    ----
   CONSTANT SIZE    =   ----    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      5    ----
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
